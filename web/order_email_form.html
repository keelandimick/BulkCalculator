<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Your Order Request - Keelan Scott</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f2ed;
        }
        
        .form-container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 30px;
        }
        
        .logo-container {
            text-align: center;
            margin-bottom: 25px;
        }
        
        h2 {
            color: #384637;
            margin-bottom: 10px;
            text-align: center;
        }
        
        p.subtitle {
            color: #666;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }
        
        input[type="text"],
        input[type="email"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s;
            box-sizing: border-box;
        }
        
        input[type="text"]:focus,
        input[type="email"]:focus {
            outline: none;
            border-color: #384637;
        }
        
        .order-details {
            background: #f4f2ed;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .order-details h3 {
            margin: 0 0 15px 0;
            color: #384637;
        }
        
        .order-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px 0;
        }
        
        .order-row.total {
            border-top: 2px solid #384637;
            padding-top: 10px;
            font-weight: bold;
            font-size: 18px;
        }
        
        .submit-btn {
            background: #384637;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 6px;
            font-size: 18px;
            cursor: pointer;
            width: 100%;
            transition: background 0.3s;
        }
        
        .submit-btn:hover {
            background: #2a3329;
        }
        
        .submit-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        .back-link {
            text-align: center;
            margin-top: 20px;
        }
        
        .back-link a {
            color: #384637;
            text-decoration: none;
        }
        
        .back-link a:hover {
            text-decoration: underline;
        }
        
        .success-message {
            display: none;
            text-align: center;
            padding: 40px;
        }
        
        .success-message h2 {
            color: #4caf50;
            margin-bottom: 20px;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
    </style>
</head>
<body>
    <script>
        // Function to send height to parent window
        function sendHeightToParent() {
            // Get all possible height measurements and use the largest
            const heights = [
                document.documentElement.scrollHeight,
                document.documentElement.offsetHeight,
                document.body.scrollHeight,
                document.body.offsetHeight,
                document.body.clientHeight
            ];
            
            const maxHeight = Math.max(...heights);
            const heightWithPadding = maxHeight + 50; // Add 50px padding for safety
            
            if (window.parent !== window) {
                window.parent.postMessage({
                    height: heightWithPadding,
                    source: 'bulkCalculator'
                }, '*');
            }
        }
        
        // Send height when page loads
        window.addEventListener('load', function() {
            setTimeout(sendHeightToParent, 100);
        });
        
        // Monitor for content changes
        const observer = new MutationObserver(() => {
            sendHeightToParent();
        });
        
        // Start observing once DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            observer.observe(document.body, {
                childList: true,
                subtree: true,
                attributes: true
            });
        });
    </script>
    <div class="form-container" id="formContainer">
        <h2>Complete Your Order Request</h2>
        <p class="subtitle">Please provide your contact information to submit your bulk order request.</p>
        
        <form id="orderForm">
            <div class="form-group">
                <label for="customerName">Your Name *</label>
                <input type="text" id="customerName" name="customerName" required>
            </div>
            
            <div class="form-group">
                <label for="customerEmail">Your Email *</label>
                <input type="email" id="customerEmail" name="customerEmail" required>
            </div>
            
            <div class="order-details">
                <h3>Order Summary</h3>
                <div id="orderSummary">
                    <!-- Order details will be populated here -->
                </div>
            </div>
            
            <button type="submit" class="submit-btn">Submit Order Request</button>
        </form>
        
        <div class="back-link">
            <a href="#" onclick="history.back(); return false;">‚Üê Back to Calculator</a>
        </div>
        
        <div class="loading">
            <p>Submitting your order request...</p>
        </div>
    </div>
    
    <div class="success-message" id="successMessage">
        <h2>Thank You for Your Order Request!</h2>
        <p style="font-size: 18px; margin-bottom: 30px;">
            We've received your bulk order request.
        </p>
        <p style="color: #666; margin-bottom: 30px;">
            A member of our team will contact you within 24 hours to confirm your order and arrange payment.
        </p>
        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
            <h3 style="margin-bottom: 15px;">Order Reference</h3>
            <p id="orderReference"></p>
        </div>
        <button class="submit-btn" onclick="window.location.href='bulk_pricing_calculator.html'">
            Submit Another Request
        </button>
    </div>
    
    <script>
        // Get order details from URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const orderData = {
            product: urlParams.get('product'),
            sku: urlParams.get('sku'),
            quantity: urlParams.get('quantity'),
            unitPrice: urlParams.get('unitPrice'),
            productSubtotal: urlParams.get('productSubtotal'),
            freightCost: urlParams.get('freightCost'),
            freightCarrier: urlParams.get('freightCarrier'),
            transitDays: urlParams.get('transitDays'),
            totalCost: urlParams.get('totalCost'),
            discount: urlParams.get('discount'),
            savings: urlParams.get('savings')
        };
        
        // Display order summary
        document.getElementById('orderSummary').innerHTML = `
            <div class="order-row">
                <span>Product:</span>
                <span>${orderData.product}</span>
            </div>
            <div class="order-row">
                <span>Quantity:</span>
                <span>${orderData.quantity} units</span>
            </div>
            <div class="order-row">
                <span>Unit Cost:</span>
                <span>${orderData.unitPrice} (${orderData.discount} discount)</span>
            </div>
            <div class="order-row">
                <span>Product Subtotal:</span>
                <span>${orderData.productSubtotal}</span>
            </div>
            <div class="order-row">
                <span>Freight Shipping:</span>
                <span>${orderData.freightCost}</span>
            </div>
            <div class="order-row total">
                <span>Total Order:</span>
                <span>${orderData.totalCost}</span>
            </div>
            ${orderData.savings ? `
                <div style="text-align: center; margin-top: 15px; color: #388e3c; font-weight: bold;">
                    ${orderData.savings}
                </div>
            ` : ''}
        `;
        
        // Handle form submission
        document.getElementById('orderForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const customerName = document.getElementById('customerName').value;
            const customerEmail = document.getElementById('customerEmail').value;
            
            // Show loading
            document.querySelector('.loading').style.display = 'block';
            document.querySelector('button[type="submit"]').disabled = true;
            
            // Create email content
            const emailSubject = `Bulk Order Request - ${orderData.product} (${orderData.quantity} units)`;
            const emailBody = `New Bulk Order Request

Customer Information:
- Name: ${customerName}
- Email: ${customerEmail}

Product Details:
- Product: ${orderData.product}
- SKU: ${orderData.sku}
- Quantity: ${orderData.quantity}

Pricing:
- Unit Price: ${orderData.unitPrice} (${orderData.discount} discount)
- Product Subtotal: ${orderData.productSubtotal}
- Freight Cost: ${orderData.freightCost}
- Freight Carrier: ${orderData.freightCarrier} (${orderData.transitDays} transit days)
- Total Order: ${orderData.totalCost}

${orderData.savings || ''}

Customer should be contacted at ${customerEmail} to confirm this order.`;
            
            // Submit to WordPress REST API
            try {
                const response = await fetch('https://keelanscott.co/wp-json/keelanscott/v1/submit-order', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        customerName: customerName,
                        customerEmail: customerEmail,
                        emailSubject: emailSubject,
                        emailBody: emailBody,
                        orderData: orderData
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Hide form
                    document.getElementById('formContainer').style.display = 'none';
                    
                    // Show success message
                    document.getElementById('successMessage').style.display = 'block';
                    document.getElementById('orderReference').innerHTML = `
                        <strong>${orderData.product}</strong><br>
                        ${orderData.quantity} units - ${orderData.totalCost}
                    `;
                    
                    // Update height after showing success message
                    setTimeout(sendHeightToParent, 100);
                } else {
                    throw new Error('Failed to submit order');
                }
            } catch (error) {
                // Fallback for testing or if API fails
                console.error('Error submitting order:', error);
                
                // Still show success for demo purposes
                setTimeout(() => {
                    document.getElementById('formContainer').style.display = 'none';
                    document.getElementById('successMessage').style.display = 'block';
                    document.getElementById('orderReference').innerHTML = `
                        <strong>${orderData.product}</strong><br>
                        ${orderData.quantity} units - ${orderData.totalCost}
                    `;
                    setTimeout(sendHeightToParent, 100);
                }, 1500);
            }
        });
        
        // Initial height send
        sendHeightToParent();
    </script>
</body>
</html>